<!--
SPDX-FileCopyrightText: 2025 Weibo, Inc.

SPDX-License-Identifier: Apache-2.0
-->

<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>CoStrict</id>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-name -->
    <name>CoStrict</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor url="https://costrict.ai">CoStrict</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Simple HTML elements (text formatting, paragraphs, and lists) can be added inside of <![CDATA[ ]]> tag.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/plugin-overview-page.html#plugin-description -->
    <description><![CDATA[
        <h1>CoStrict (prev. Shenma)</h1>
        <h2>Strict AI coder for enterprises</h2>
        <p>CoStrict is a <strong>free, open-source AI-assisted programming tool</strong> that supports private deployment for enterprises, making it the optimal choice for enterprise serious programming. Its core capabilities are outstanding: <strong>Strict Mode，Code Review</strong> , Code Completion, etc. Feature highlights include: enterprise-level business understanding, standardized AI development processes, Vibe Mode, MCP service, multiple advanced free models, API/model customization, mode selection/customization, image context capabilities, and more. It supports multiple mainstream IDEs and leads the way in supporting VS Code and JetBrains IDEs. Compatible with popular languages including Python, Go, Java, JavaScript/ TypeScript, and C/C++."</p>
        
        <h2>Features</h2>
        <ul>
            <li><strong>Strict Mode</strong>:<br>
                Strict Mode standardizes the process of AI-generated code, making it more aligned with enterprise development scenarios. It systematically breaks down a single requirement into steps such as：Requirements Analysis, Architecture Design, Task Planning and Test Generation etc. acting as a standardized procedure for AI to ensure high-quality and highly controllable output.
            </li>
            <li><strong>Code Review</strong>: <br>
                Code Review enables indexing and parsing of entire code repositories, implementing company-wide RAG (Retrieval-Augmented Generation) for coding knowledge.
It adopts the strategy of "specialized checks by a multi-expert model" + "cross-confirmation by multiple models."
It supports users in conducting code checks on functions, selected code lines, code files, and entire project files.
            </li>
            <li><strong>More features</strong>: <br>
                <ul>
                    <li><strong>Code Completion:</strong> Automatically generates subsequent code based on the cursor's context code, quickly outputs code in seconds</li>
                    <li><strong>Vibe Code:</strong> Vibe Code is designed for rapid development and simple tasks. It supports multi-turn natural language dialogue, allowing for real-time refinement and precise code generation.</li>
                    <li><strong>MCP Service:</strong> Seamlessly integrates with the MCP open ecosystem to enable standardized system connectivity. You can Integrate external APIs、Connect to databases、Develop custom tools through MCP services.</li>
                    <li><strong>APIs & Model Customization:</strong> Officially provided are multiple free advanced models; it also supports using third-party API providers such as Anthropic, OpenAI, etc.; you can also configure any API compatible with OpenAl; or use local models through I M Studio/Ollama</li>
                    <li><strong>Mode Customization:</strong> We provide various default modes to adapt to different scenarios, such as the Code mode with outstanding coding capabilities and the Orchestrator mode skilled in complex task decomposition. You can also customize mode according to your needs.</li>
                    <li><strong>Context:</strong> Shenma will automatically incorporate all repository data of large files into the context, and for code completion scenarios, it will also dynamically perceive the context based on the cursor position. You can also add files/folders, terminals, issues, etc. using the @ key to provide more precise context information for the input.</li>
                    <li><strong>Image:</strong> You can click the image icon below the dialog box to upload an image, or you can hold down the Shift key to drag and drop the image into the input box.</li>
                    <li><strong>Multi-language Support:</strong> Supports mainstream programming languages: Python, Go, Java, JavaScript, TypeScript, C/C++ and all other programming languages</li>
                    <li><strong>Privacy & Security:</strong> To ensure data security and provide better service at a lower cost, we offer a professional and comprehensive private deployment solution, ensuring code security through physical isolation and end-to-end encryption.</li>
                </ul>
            </li>
        </ul>
        
        <h2>Supported IDEs</h2>
        <p>CoStrict currently supports the following JetBrains IDE series:</p>
        <ul>
            <li><strong>IntelliJ IDEA</strong> (Ultimate & Community)</li>
            <li><strong>WebStorm</strong> - JavaScript and TypeScript development</li>
            <li><strong>PyCharm</strong> (Professional & Community) - Python development</li>
            <li><strong>PhpStorm</strong> - PHP development</li>
            <li><strong>RubyMine</strong> - Ruby development</li>
            <li><strong>CLion</strong> - C/C++ development</li>
            <li><strong>GoLand</strong> - Go development</li>
            <li><strong>DataGrip</strong> - Database development</li>
            <li><strong>Rider</strong> - .NET development</li>
            <li><strong>Android Studio</strong> - Android development</li>
        </ul>
        
        
        <h2>Requirements</h2>
        <ul>
            <li>Requires <a href="https://nodejs.org/">Node.js</a> v20+ installed</li>
            <li>Requires JetBrains IDE version 2023.3 or later for optimal compatibility</li>
        </ul>
   ]]></description>
   
   <!-- Change notes for the plugin -->
   <change-notes><![CDATA[
       <h3>Version 2.2.3</h3>
        <a href="https://github.com/zgsm-ai/costrict/blob/main/CHANGELOG.md">changelog</a>
   ]]></change-notes>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>org.jetbrains.plugins.terminal</depends>
    
    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <projectService serviceImplementation="ai.costrict.plugin.WecoderPluginService"/>
        <postStartupActivity implementation="ai.costrict.plugin.WecoderPlugin"/>
        <editorFactoryListener implementation="ai.costrict.editor.EditorListener"/>
        <codeInsight.lineMarkerProvider language="Markdown"
                                        implementationClass="ai.costrict.extensions.plugin.costrict.WorkflowLineMarkerProvider"/>
        <postStartupActivity implementation="ai.costrict.extensions.plugin.costrict.TaskLineBackgroundProviderInitializer"/>
                                  
        <toolWindow factoryClass="ai.costrict.ui.RunVSAgentToolWindowFactory"
                    id="CoStrict"
                    secondary="true"
                    icon="/icons/costrict.svg"
                    anchor="right" />
        <notificationGroup id="CoStrict"
                           displayType="BALLOON"/>
    </extensions>

    <extensions defaultExtensionNs="org.jetbrains.plugins.terminal">
        <localTerminalCustomizer implementation="ai.costrict.terminal.WeCoderTerminalCustomizer"/>
    </extensions>

    <actions>
<!--        <action id="RunVSAgent.extensionSwitcher"-->
<!--                icon="AllIcons.Actions.Refresh"-->
<!--                class="com.sina.weibo.agent.extensions.ui.actions.ExtensionSwitcherAction"-->
<!--                text="Switch Extension Provider"-->
<!--                description="Switch to a different extension provider">-->
<!--            <override-text place="GoToAction" text="Switch Extension" />-->
<!--            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt S" />-->
<!--        </action>-->


        <!-- Dynamic toolbar group - buttons will be populated based on current extension -->
        <group id="CoStrict.ToolbarGroup">
            <group id="CoStrict.DynamicExtensionActions"
                   class="ai.costrict.extensions.ui.actions.DynamicExtensionActionsGroup"
                   text="Extension Actions"
                   description="Dynamic extension-specific actions" />
<!--            <reference ref="RunVSAgent.extensionSwitcher" />-->
            <action id="CoStrict.extensionStatusChecker"
                    icon="AllIcons.General.InspectionsOK"
                    class="ai.costrict.extensions.ui.actions.ExtensionStatusChecker"
                    text="Check Extension Status"
                    description="Check extension status and diagnose issues" />
        </group>

        <group id="CoStrict.RightClickMenu" text="CoStrict" description="CoStrict main menu"  icon="/icons/costrict_logo_13px.svg" popup="true">
            <group id="CoStrict.RightClick.Chat" class="ai.costrict.extensions.ui.contextmenu.DynamicExtensionContextMenuGroup"
                   text="Extension Actions" description="Dynamic extension-specific context menu actions"/>
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>

        <group id="CoStrict.ProjectView.Menu"
            text="CoStrict"
            description="Costrict AI Assistant"
            icon="/icons/costrict_logo_13px.svg"
            popup="true">

            <!-- 动态生成的扩展动作（类似 RunVSAgent.DynamicExtensionActions） -->
            <group id="CoStrict.ProjectView.DynamicExtensionActions"
                class="ai.costrict.extensions.ui.actions.ProjectViewExtensionActionsGroup"
                text="Extension Actions"
                description="Dynamic extension-specific actions"/>

            <!-- 添加到 项目文件右键菜单 -->
            <add-to-group group-id="ProjectViewPopupMenu" anchor="first"/>
        </group>

        <!-- Right-click menu for extension switching -->
        <group id="CoStrict.RightClick.Extensions" text="Extensions" description="Extension management">
<!--            <reference ref="RunVSAgent.extensionSwitcher" />-->
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Right-click menu for extension-specific actions -->
        <group id="CoStrict.RightClick.ExtensionActions" text="Extension Actions" description="Extension-specific actions">
            <group id="CoStrict.RightClick.DynamicExtensionActions"
                   class="ai.costrict.extensions.ui.actions.DynamicExtensionActionsGroup"
                   text="Extension Actions"
                   description="Dynamic extension-specific actions" />
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Main menu integration -->
        <group id="CoStrict.MainMenu" text="CoStrict" description="CoStrict main menu">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
<!--            <reference ref="RunVSAgent.extensionSwitcher" />-->
            <group id="CoStrict.MainMenu.DynamicExtensionActions"
                   class="ai.costrict.extensions.ui.actions.DynamicExtensionActionsGroup"
                   text="Extension Actions"
                   description="Dynamic extension-specific actions" />
        </group>
    </actions>
</idea-plugin>